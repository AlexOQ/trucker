# Fix Error Handling

## Goal

Fix error handling in storage.js and data.js - GitHub issue #25.

## Critical Issues

1. `getSelectedCountries()` has no try-catch (storage.js:163-166)
2. `loadJson()` doesn't check response.ok (data.js:8-16)
3. `setSelectedCountries()` has no error handling (storage.js:171-173)
4. Empty catch blocks need logged warnings

## Completed Tasks
- [x] 1.1 Fix getSelectedCountries in storage.js - 964c206
- [x] 1.2 Fix setSelectedCountries in storage.js - 8132ec0
- [x] 1.3 Fix loadJson in data.js - pending

## Current Task
Awaiting next task

## Status

Phase: Execution

## Reality Check (BEFORE)

**Goal type**: Fix
**Reproduction command**: Code inspection (no runtime test available)
**Issues identified**: 4 error handling gaps

**Key errors to resolve**:
- getSelectedCountries: JSON.parse without try-catch
- setSelectedCountries: localStorage.setItem without try-catch
- loadJson: No response.ok check before JSON parse
- cities.html getCollapsedCountries: Empty catch block

## Learnings

- Pattern exists in codebase: loadState/saveState in storage.js show proper error handling
- Warning message format: `console.warn('Failed to [action]:', e)`
- Default return values: [] for array functions, {...defaultState} for objects
- Empty catch blocks in cities.html:56-57 swallow errors silently
- index.html, cargo.html, companies.html have proper error handling in init()
